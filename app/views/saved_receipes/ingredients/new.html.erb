<% content_for :title, "New receipe" %>
<%= govuk_back_link href: edit_saved_receipes_path(@my_receipe) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds counter">
    <h1 class="govuk-header-l">New receipe</h1>

    <%= form_with(
      model: @my_receipe,
      url: saved_receipe_ingredients_path,
      data: { controller: 'nested-form', nested_form_wrapper_selector_value: '.nested-form-wrapper', nested_form_target: 'form' },
      method: :post,
    ) do |form| %>
      <% if @my_receipe.errors.any? %>
        <div style="color: red">
          <h2><%= pluralize(@my_receipe.errors.count, "error") %> prohibited this receipe from being saved:</h2>

          <ul>
            <% @my_receipe.errors.each do |error| %>
            <% end %>
          </ul>
        </div>
      <% end %>

      <template data-nested-form-target="template">
        <% record = ReceipeIngredient.new; record.build_ingredient; record %>

        <%= form.fields_for :receipe_ingredients, record, child_index: 'NEW_RECORD' do |receipe_ingredient_form| %>
          <%= render "ingredient", receipe_ingredient_form: %>
        <% end %> 
      </template>

      <%= form.fields_for :receipe_ingredients do |receipe_ingredient_form| %>
        <%= render "ingredient", receipe_ingredient_form: receipe_ingredient_form %>
      <% end %>

      <div data-nested-form-target="target"></div>

      <%= govuk_button_link_to(
        "Add ingredient",
        secondary: true,
        class: "govuk-!-margin-top-4",
        data: { action: "nested-form#add" },
      ) %>
      <br>

      <%= form.govuk_submit "Continue" %>
    <% end %>
  </div>
</div>

